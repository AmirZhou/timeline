# Development Workflow Guide
## @bitravage/timeline

This document outlines the development workflow for contributing to and maintaining the timeline project and its NPM package.

---

## 🌳 **Branch Structure**

### **Main Branches**
- **`main`**: Stable production branch (original timeline app)
- **`npm-package-timeline`**: NPM package development branch
- **Feature branches**: `feature/feature-name` for new development

### **Branch Usage**
```bash
# Working on the original timeline app
git checkout main

# Working on the NPM package
git checkout npm-package-timeline

# Creating new features
git checkout -b feature/add-new-theme
```

---

## 🚀 **Development Environment**

### **Quick Start**
```bash
# Clone and setup
git clone https://github.com/AmirZhou/timeline.git
cd timeline
git checkout npm-package-timeline
npm install
```

### **Environment Files**
```bash
# .env.local (auto-generated by Convex)
VITE_CONVEX_URL=https://courteous-tortoise-261.convex.cloud
NOTION_API_KEY=your_notion_api_key_here
CONVEX_DEPLOYMENT=dev:courteous-tortoise-261
```

### **Running Development Server**
```bash
# Start both frontend and backend
npm run dev
# Opens: http://localhost:5174/

# Individual servers
npm run dev:frontend  # Vite dev server
npm run dev:backend   # Convex dev server
```

---

## 🏗️ **Project Architecture**

### **Dual Purpose Structure**
This project serves two purposes:
1. **Original Timeline App**: Full-screen timeline application
2. **NPM Package**: Reusable Timeline component

### **Key Files**
```
src/
├── Timeline.tsx          # 🎯 Main NPM package export
├── index.ts             # 📦 Package entry point  
├── Demo.tsx             # 🎪 Interactive demo
├── App.tsx              # 🖥️  Demo wrapper
└── components/
    ├── ProjectTimeline.tsx    # Original timeline (not exported)
    ├── providers/
    │   └── ThemeProvider.tsx  # 🎨 Theme system
    └── ... (all other components)
```

### **Build Targets**
- **App Build**: `npm run build` → Full demo application
- **Package Build**: `npm run build:lib` → NPM package distribution

---

## 💻 **Development Commands**

### **Development**
```bash
npm run dev                    # Start dev servers (frontend + backend)
npm run dev:frontend          # Vite dev server only
npm run dev:backend           # Convex dev server only
```

### **Building**
```bash
npm run build                 # Build demo application
npm run build:lib             # Build NPM package
```

### **Testing & Linting**
```bash
npm run lint                  # Full validation pipeline
# Runs: TypeScript check + Convex validation + Build test
```

### **Package Management**
```bash
npm version patch             # Version bump
npm publish --access public   # Publish to NPM
```

---

## 🔄 **Feature Development Workflow**

### **1. Planning**
- [ ] Identify if change affects original app, NPM package, or both
- [ ] Create feature branch from appropriate base branch
- [ ] Plan implementation approach

### **2. Implementation**
```bash
# Create feature branch
git checkout npm-package-timeline
git pull origin npm-package-timeline
git checkout -b feature/your-feature-name

# Make changes
# ... code changes ...

# Test changes
npm run dev
# Test in browser at http://localhost:5174/
```

### **3. Testing Checklist**
- [ ] **Theme Testing**: Both dark and light themes work
- [ ] **Notion Sync**: Data loads from Notion API
- [ ] **Responsive**: Works on mobile and desktop
- [ ] **Accessibility**: Keyboard navigation, screen reader support
- [ ] **Build**: `npm run build:lib` succeeds
- [ ] **Linting**: `npm run lint` passes

### **4. Code Review & Merge**
```bash
# Commit changes
git add .
git commit -m "feat: your descriptive commit message"

# Push feature branch
git push origin feature/your-feature-name

# Create PR to npm-package-timeline
# After review, merge to base branch
```

---

## 🎨 **Theme Development**

### **Theme Architecture**
```typescript
// ThemeProvider.tsx structure
interface ThemeColors {
  background: string;      // Main background
  text: string;           // Primary text
  textSecondary: string;  // Secondary text
  accent: string;         // Accent color (#00ff00)
  success: string;        // Success states
  warning: string;        // Warning states  
  error: string;          // Error states
  border: string;         // Border colors
  glass: {               // Glassmorphism effects
    background: string;   // Glass background
    border: string;       // Glass border
  };
}
```

### **Adding New Themes**
1. **Define Theme Colors**:
   ```typescript
   const newTheme: ThemeColors = {
     // Define all colors...
   };
   ```

2. **Update Theme Type**:
   ```typescript
   export type ThemeMode = 'dark' | 'light' | 'new-theme';
   ```

3. **Update Theme Logic**:
   ```typescript
   const colors = theme === 'new-theme' ? newTheme : 
                  theme === 'light' ? lightTheme : darkTheme;
   ```

4. **Test thoroughly** across all components

---

## 🧪 **Testing Strategy**

### **Manual Testing**
1. **Theme Switching**: Test both dark/light modes
2. **Data Loading**: Verify Notion API connection  
3. **Interactive Elements**: Task clicks, modal opening/closing
4. **Responsive Design**: Test on different screen sizes
5. **Accessibility**: Keyboard navigation, focus states

### **Component Testing**
- Each component should maintain existing functionality
- Props interfaces should remain backward compatible
- No console errors or warnings

### **Build Testing**
```bash
# Test package build
npm run build:lib
ls -la dist/  # Should show index.es.js and index.umd.js

# Test regular app build  
npm run build
```

---

## 📦 **Package Release Process**

### **Pre-Release**
1. **Update version** in package.json:
   ```bash
   npm version patch|minor|major
   ```

2. **Test build**:
   ```bash
   npm run build:lib
   ```

3. **Update documentation** if needed

4. **Commit all changes**:
   ```bash
   git add .
   git commit -m "chore: prepare v1.x.x release"
   git push origin npm-package-timeline
   ```

### **Release**
```bash
# Publish to NPM
npm publish --access public

# Verify published package
npm view @bitravage/timeline
```

### **Post-Release**
1. **Test installation**:
   ```bash
   # In a test project
   npm install @bitravage/timeline@latest
   ```

2. **Update documentation** with new version number
3. **Create release notes** if significant changes

---

## 🔧 **Configuration Files**

### **Key Configuration**
- **`vite.config.ts`**: Build configuration for both app and package
- **`package.json`**: NPM package configuration
- **`tsconfig.json`**: TypeScript configuration
- **`tailwind.config.js`**: Styling configuration

### **Important Package.json Fields**
```json
{
  "main": "dist/index.umd.js",     // CommonJS entry
  "module": "dist/index.es.js",    // ES modules entry  
  "files": ["dist"],               // Published files
  "scripts": {
    "build:lib": "vite build --mode lib",
    "prepublishOnly": "npm run build:lib"
  }
}
```

---

## 🐛 **Troubleshooting**

### **Common Development Issues**

**1. Dev Server Won't Start**
```bash
# Check ports
lsof -i :5174  # Frontend port
lsof -i :5173  # Alternative port

# Clear cache
rm -rf node_modules/.vite
npm run dev
```

**2. Build Failures**
```bash
# Clear build cache
rm -rf dist/
npm run build:lib
```

**3. Convex Issues**  
```bash
# Check Convex status
npx convex dev --once

# Verify environment variables
npx convex env list
```

**4. Theme Issues**
- Check CSS variable injection in ThemeProvider
- Verify theme prop is passed correctly
- Test CSS custom properties in browser dev tools

---

## 📚 **Learning Resources**

### **Project-Specific**
- `CLAUDE.md`: Comprehensive project overview
- `README-package.md`: User-facing package documentation
- Component source code with JSDoc comments

### **Technologies Used**
- **React 19**: Latest React features
- **TypeScript**: Type safety
- **Vite**: Build tool and dev server
- **Tailwind CSS**: Utility-first CSS
- **Convex**: Backend and database
- **Notion API**: Data source

---

## 📈 **Performance Considerations**

### **Package Size**
- **Current**: 51.8 kB compressed, 188.0 kB unpacked
- **Target**: Keep under 60 kB compressed
- **Monitor**: Bundle analyzer for large dependencies

### **Build Optimization**
- External dependencies (React, React-DOM) not bundled
- Tree-shaking enabled for ES modules
- CSS-in-JS for zero external stylesheets

### **Runtime Performance**  
- Theme switching via CSS custom properties (fast)
- Memoized Convex client creation
- Efficient state management in providers

---

**Last Updated**: August 25, 2025  
**Current Version**: 1.0.0  
**Maintainer**: bitravage